{% extends 'base.html' %}
{% block content %}
    <head>
        <style>
            .containers {max-width: 1100px; padding: 0 20px; margin:0 auto;}
            .panel {margin: 100px auto 40px; max-width: 500px; text-align: center;}
            .button_outer {background: #83ccd3; border-radius:30px; text-align: center; height: 50px; width: 200px; display: inline-block; transition: .2s; position: relative; overflow: hidden;}
            .btn_upload {padding: 12px 30px 12px; color: #fff; text-align: center; position: relative; display: inline-block; overflow: hidden; z-index: 3; white-space: nowrap;}
            .btn_upload input {position: absolute; width: 100%; left: 0; top: 0; width: 100%; height: 105%; cursor: pointer; opacity: 0;}
            .file_uploading {width: 100%; height: 10px; margin-top: 20px; background: #ccc;}
            .file_uploading .btn_upload {display: none;}
            .processing_bar {position: absolute; left: 0; top: 0; width: 0; height: 100%; border-radius: 30px; background:#83ccd3; transition: 3s;}
            .file_uploading .processing_bar {width: 100%;}
            .success_box {display: none; width: 50px; height: 50px; position: relative;}
            .success_box:before {content: ''; display: block; width: 9px; height: 18px; border-bottom: 6px solid #fff; border-right: 6px solid #fff; -webkit-transform:rotate(45deg); -moz-transform:rotate(45deg); -ms-transform:rotate(45deg); transform:rotate(45deg); position: absolute; left: 17px; top: 10px;}
            .file_uploaded .success_box {display: inline-block;}
            .file_uploaded {margin-top: 0; width: 50px; background:#83ccd3; height: 50px;}
            .uploaded_file_view {max-width: 500px; margin: 40px auto; text-align: center; position: relative; transition: .2s; opacity: 0; border: 2px solid #ddd; padding: 15px; display: none;}
            .file_remove{width: 30px; height: 30px; border-radius: 50%; display: block; position: absolute; background: #aaa; line-height: 30px; color: #fff; font-size: 12px; cursor: pointer; right: -15px; top: -15px;}
            .file_remove:hover {background: #222; transition: .2s;}
            .uploaded_file_view img {max-width: 100%;}
            .uploaded_file_view.show {opacity: 1;}
            .error_msg {text-align: center; color: #f00}
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <section class="" style="background-color: #eee;">
        <div class="container py-5 h-100">
            <!-- 오류 표시 Start -->
             {% if form.errors %}
             <div class="alert alert-danger" role="alert">
                {% for field in form %}
                    {% if field.errors %}
                        <strong>{{ field.label }}</strong>
                        {{ field.errors }}
                    {% endif %}
                 {% endfor %}
             </div>
             {% endif %}
            <!-- 오류 표시 End -->
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-12 col-xl-8 col-lg-6 col-xl-5">
              <div class="card shadow-2-strong" style="border-radius: 1rem;">
                <div class="card-body p-5 text-center">

                     <form method="post" class="post-form " enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="form-group">
                            <div class="button_outer">
                                <div class="btn_upload">
                                    <input type="file" class="form-control" id="upload_file" name="image" value="{{ form.image.value|default_if_none:'' }}">
                                    <span>Upload Image</span>
                                </div>
                                <div class="processing_bar"></div>
                                <div class="success_box"></div>
                            </div>
                            <div class="error_msg"></div>
                            <div class="uploaded_file_view" id="uploaded_view">
                                <span class="file_remove">X</span>
                                {% if form.instance.image %}
                                <script>
                                    $(document).ready(function(){
                                        $("#uploaded_view").addClass("show");
                                        $("#uploaded_view").css("display","block");
                                        btnOuter.addClass("file_uploading");
                                        btnOuter.addClass("file_uploaded");
                                       })
                                </script>
                                <img id="pre_img"src="{{ form.instance.image.url }}">
                                {% endif %}
                            </div>
                        </div>
                         <div class="mb-3">
                            <label for="subject" class="form-label">제목</label>
                            <input type="text" class="form-control" name="subject" id="subject"
                                   value="{{ form.subject.value|default_if_none:'' }}">
                        </div>
                        <div class="form-group">
                            <label for="content" class="form-label">내용</label>
                            <textarea class="form-control" name="content" id="content" rows="8">{{ form.content.value|default_if_none:'' }}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary mt-3">올리기</button>
                         <button type="button" class="btn btn-danger mt-3" onclick="history.back()">취소</button>
                    </form>

                </div>
              </div>
            </div>
          </div>
        </div>
    </section>

<script>
    var btnUpload = $("#upload_file"),
		btnOuter = $(".button_outer");
	btnUpload.on("change", function(e){
		var ext = btnUpload.val().split('.').pop().toLowerCase();
		if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
			$(".error_msg").text("Not an Image...");
		} else {
			$(".error_msg").text("");
            $("#uploaded_view").show();
			btnOuter.addClass("file_uploading");
			setTimeout(function(){
				btnOuter.addClass("file_uploaded");
			},500);
			var uploadedFile = URL.createObjectURL(e.target.files[0]);
			setTimeout(function(){
				$("#uploaded_view").append('<img src="'+uploadedFile+'" />').addClass("show");
			},580);
			$("#pre_img").remove()
		}
	});
	$(".file_remove").on("click", function(e){
	    $("#upload_file").val("")
		$("#uploaded_view").removeClass("show");
		$("#uploaded_view").find("img").remove();
		$("#uploaded_view").hide();
		btnOuter.removeClass("file_uploading");
		btnOuter.removeClass("file_uploaded");
	});
</script>
{% endblock %}